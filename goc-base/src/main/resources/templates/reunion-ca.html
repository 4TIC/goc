<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <div th:substituteby="head-ca" />
  <body>
    <div class="off-canvas-content" data-off-canvas-content="data-off-canvas-content">
      <div th:substituteby="header-ca" />
    </div>
    <main class="columns reunion">
      <div class="row columns">
        <h2 th:text="'Reunió: ' + ${reunion.asunto}" class="title">title</h2>
      </div>
      <div class="row columns">
        <h3 class="title" >Informació bàsica</h3>      
      </div>
      <ul class="contentList detalle row columns">
        <li th:utext="'&lt;strong&gt;Data&lt;/strong&gt;: ' + ${#dates.format(reunion.fecha, 'dd/MM/YYYY HH:mm')}"></li>
        <li th:if="${reunion.fechaSegundaConvocatoria}" th:utext="'&lt;strong&gt;Segona convocatòria&lt;/strong&gt;: ' + ${#dates.format(reunion.fechaSegundaConvocatoria, 'dd/MM/YYYY HH:mm')}"></li>
        <li th:if="${reunion.responsableActa}" th:utext="'&lt;strong&gt;Responsable d\'acta&lt;/strong&gt;: ' + ${reunion.responsableActa}"></li>
        <li th:if="${reunion.numeroSesion} != null" th:utext="'&lt;strong&gt;Número de sessió&lt;/strong&gt;: ' + ${reunion.numeroSesion}"></li>
        <li th:if="${reunion.ubicacion}" th:utext="'&lt;strong&gt;Lloc&lt;/strong&gt;: ' + ${reunion.ubicacion}"></li>
        <li th:utext="'&lt;strong&gt;Duració&lt;/strong&gt;: ' + ${reunion.duracion} + ' minuts'"></li>
        <li th:if="${reunion.descripcion}" th:utext="'&lt;strong&gt;Descripció&lt;/strong&gt;: ' + ${reunion.descripcion}"></li>
        <li th:if="${reunion.acuerdos != null}" th:utext="'&lt;strong&gt;Acords&lt;/strong&gt;: ' + ${reunion.acuerdos}"></li>
        <li th:if="${reunion.urlGrabacion != null}"><strong>URL gravació</strong>: <a th:href="${reunion.urlGrabacion}" th:text="${reunion.urlGrabacion}"></a></li>
        <li th:if="${reunion.telematica}"><strong>Reunió telemàtica. Instruccions</strong>: <span th:text="${reunion.telematicaDescripcion}"></span></li>
      </ul>
      <div th:if="${not #lists.isEmpty(reunion.organos)}" class="row columns">
        <h3 class="title">Òrgans i assistents</h3>      
      </div>
      <ul th:if="${not #lists.isEmpty(reunion.organos)}" class="contentList detalle row columns">
        <li th:each="organo : ${reunion.organos}">
          <h4 class="title" th:text="${organo.nombre}">Òrgan assistent</h4>
          <ul th:with="miembros=${organo.asistentes}">
            <li th:each="miembro : ${miembros}">
              <div>
                <span th:text="${miembro.nombre} + ' (' + ${miembro.email} + ')' + ' - ' + ${miembro.cargo.nombre}">Miembro</span>
                <span class="asistencia asistira" th:if="${miembro.asistenciaConfirmada}">Assistirà</span>
                <span class="asistencia no-asistira" th:if="${miembro.asistenciaConfirmada == false}">No assistirà</span>
                <div class="detalle">
                  <strong th:if="${miembro.suplente}" th:text="'Suplent: ' + ${miembro.suplente} ">Suplente</strong>
                </div>
                <div class="detalle">
                  <strong th:if="${miembro.delegadoVoto}" th:text="'Delegació de vot: ' + ${miembro.delegadoVoto} ">Suplente</strong>
                </div>
              </div>
              <div class="detalle confirmacion" th:if="${reunion.completada != true and (connectedUserId == miembro.miembroId)}">
                <button class="button success tiny" th:attr="data-miembroid=${miembro.id}" th:if="${miembro.asistenciaConfirmada == true or miembro.delegadoVotoId != null}" disabled="disabled" name="confirmar">Assistirà</button>
                <button class="button success tiny" th:attr="data-miembroid=${miembro.id}" th:unless="${miembro.asistenciaConfirmada == true or miembro.delegadoVotoId != null}" name="confirmar">Assistirà</button>

                <button class="button alert tiny" th:attr="data-miembroid=${miembro.id}" th:if="${miembro.asistenciaConfirmada == false or miembro.suplenteId != null}" disabled="disabled" name="denegar">No assistirà</button>
                <button class="button alert tiny" th:attr="data-miembroid=${miembro.id}" th:unless="${miembro.asistenciaConfirmada == false or miembro.suplenteId != null}" name="denegar">No assistirà</button>

                <button class="button tiny" disabled="disabled" style="margin-left: 3em;" th:attr="data-miembroid=${miembro.id}, data-suplente=${miembro.suplente}" th:if="${reunion.admiteSuplencia and (miembro.asistenciaConfirmada == false or miembro.delegadoVotoId != null)}" name="suplente">Gestionar suplent</button>
                <button class="button tiny" style="margin-left: 3em;" th:attr="data-miembroid=${miembro.id}, data-suplente=${miembro.suplente}" th:if="${reunion.admiteSuplencia and (miembro.asistenciaConfirmada == null or miembro.asistenciaConfirmada == true) and miembro.delegadoVotoId == null}" name="suplente">Gestionar suplent</button>
                <button class="button tiny secondary" th:attr="data-miembroid=${miembro.id}" th:if="${reunion.admiteSuplencia and miembro.suplenteId != null}" name="borra-suplente-directo">Esborrar suplent</button>

                <button class="button tiny" style="margin-left: 3em;" disabled="disabled" th:attr="data-miembroid=${miembro.id}, data-delegado-voto=${miembro.delegadoVoto}" th:if="${reunion.admiteDelegacionVoto and (miembro.asistenciaConfirmada == true or miembro.suplenteId != null)}" name="delegado-voto">Gestionar delegació de vot</button>
                <button class="button tiny" style="margin-left: 3em;" th:attr="data-miembroid=${miembro.id}, data-delegado-voto=${miembro.delegadoVoto}" th:if="${reunion.admiteDelegacionVoto and (miembro.asistenciaConfirmada == null or miembro.asistenciaConfirmada == false) and miembro.suplenteId == null}" name="delegado-voto">Gestionar delegació de vot</button>
                <button class="button tiny secondary" th:attr="data-miembroid=${miembro.id}" th:if="${reunion.admiteDelegacionVoto and miembro.delegadoVotoId != null}" name="borra-delegado-voto-directo">Esborrar delegació de vot</button>
              </div>
            </li>
          </ul>
        </li>
      </ul>
      <div th:if="${not #lists.isEmpty(reunion.invitados)}" class="row columns">
        <h3 class="title">Convidats</h3>      
      </div>
      <ul th:if="${not #lists.isEmpty(reunion.invitados)}" class="contentList detalle row columns">
        <li th:each="invitado : ${reunion.invitados}">
          <span th:text="${invitado.nombre} + ' (' + ${invitado.email} + ')'">Invitado</span>
        </li>
      </ul>
      <div th:if="${not #lists.isEmpty(reunion.documentos)}" class="row columns">
        <h3 class="title">Documentació</h3>      
      </div>
      <ul th:if="${not #lists.isEmpty(reunion.documentos)}" class="contentList detalle row columns">
        <li th:each="documento : ${reunion.documentos}">
          <a th:href="'/goc/rest/reuniones/' + ${reunion.id} + '/documentos/' + ${documento.id} + '/descargar'">Descripcion documento
          </a>
          <small th:text="' [' + ${#dates.format(documento.fechaAdicion, 'dd/MM/YYYY HH:mm')} + ']'"></small>
        </li>
      </ul>
      <div th:if="${not #lists.isEmpty(reunion.puntosOrdenDia)}" class="row columns">
        <h3 class="title">Punts de l'ordre del dia</h3>      
      </div>
      <ol th:if="${not #lists.isEmpty(reunion.puntosOrdenDia)}" class="detalle row columns">
        <li th:each="puntoOrdenDia : ${reunion.puntosOrdenDia}">
          <strong th:text="${puntoOrdenDia.titulo}"></strong>
          <div th:if="${puntoOrdenDia.descripcion} != null" th:utext="'&lt;strong&gt;Descripció&lt;/strong&gt;: ' + ${puntoOrdenDia.descripcion}"></div>
          <div th:if="${puntoOrdenDia.deliberaciones} != null" th:utext="'&lt;strong&gt;Deliberacions&lt;/strong&gt;: ' + ${puntoOrdenDia.deliberaciones}"></div>
          <div th:if="${puntoOrdenDia.acuerdos} != null and ${reunion.completada}" th:utext="'&lt;strong&gt;Acords&lt;/strong&gt;: ' + ${puntoOrdenDia.acuerdos}"></div>
          <div th:if="${puntoOrdenDia.acuerdos} != null and not ${reunion.completada}" th:utext="'&lt;strong&gt;Proposta d\'acords&lt;/strong&gt;: ' + ${puntoOrdenDia.acuerdos}"></div>
          <strong th:if="${not #lists.isEmpty(puntoOrdenDia.documentos)}">Documentació:</strong>
          <ul class="contentList" th:with="documentos=${puntoOrdenDia.documentos}">
            <li th:each="documento : ${documentos}">
              <a th:href="'/goc/rest/reuniones/' + ${reunion.id} + '/puntosOrdenDia/' + ${puntoOrdenDia.id} + '/documentos/' + ${documento.id} + '/descargar'" th:text="${documento.descripcion}">Descripcion documento</a>
              <small th:text="' [' +  ${#dates.format(documento.fechaAdicion, 'dd/MM/YYYY HH:mm')} + ']'"></small>
            </li>
          </ul>
          <strong th:if="${not #lists.isEmpty(puntoOrdenDia.documentosAcuerdos)} and ${reunion.completada}">Acords:</strong>
          <strong th:if="${not #lists.isEmpty(puntoOrdenDia.documentosAcuerdos)} and not ${reunion.completada}">Proposta d'acords:</strong>
          <ul class="contentList" th:with="acuerdos=${puntoOrdenDia.documentosAcuerdos}">
            <li th:each="acuerdo : ${acuerdos}">
              <a th:href="'/goc/rest/reuniones/' + ${acuerdo.id} + '/puntosOrdenDia/' + ${puntoOrdenDia.id} + '/acuerdos/' + ${acuerdo.id} + '/descargar'" th:text="${acuerdo.descripcion}">Descripcion acuerdo</a>
              <small th:text="' [' +  ${#dates.format(acuerdo.fechaAdicion, 'dd/MM/YYYY HH:mm')} + ']'"></small>
            </li>
          </ul>
          <strong th:if="${not #lists.isEmpty(puntoOrdenDia.descriptores)}">Descriptors:</strong>
          <ul class="contentList" th:with="descriptores=${puntoOrdenDia.descriptores}">
            <li th:each="descriptor : ${descriptores}">
              <span th:text="${descriptor.descriptorNombre}">Nombre descriptior</span>
              :
              <span th:text="${descriptor.claveNombre}">Nombre clave</span>
            </li>
          </ul>
          <br />
        </li>
      </ol>
      <div class="row columns">
        <h3 class="title">Convocant</h3>   
        <span class="detalle" th:text="${reunion.creadorNombre} + ' (' + ${reunion.creadorEmail} + ')'">Info convocante</span>
      </div>

      <div class="nuevo-suplente" style="display: none;">
        <input type="hidden" name="organoMiembroId" />
        <p class="suplente-actual">Suplent actual: <strong></strong> <button class="button small" name="borra-suplente">Esborrar suplent</button></p>
        <p>Afegir un suplent:</p>
        <div class="header">
          <input type="text" name="query-persona" /><button class="button" name="busca-persona">Cerca</button>
        </div>
        <ul class="resultados">
        </ul>
        <div class="footer">
          <button class="button" name="add-suplente">Afegeix suplent</button>
        </div>
      </div>

      <div class="nuevo-delegado-voto" style="display: none;">
        <input type="hidden" name="organoMiembroId" />
        <p class="delegado-voto-actual">Delagació de vot actual: <strong></strong> <button class="button small" name="borra-delegado-voto">Esborrar delegació de vot</button></p>
        <p>Afegir una delegació de vot:</p>
        <ul class="resultados">
        </ul>
        <div class="footer">
          <button class="button" name="add-delegado-voto">Afegeix delegació de vot</button>
        </div>
      </div>

      <div class="nuevo-comentario" style="display: none;">
        <p>Afegir un comentari:</p>
        <input type="hidden" name="reunionId" th:value="${reunion.id}" />
        <textarea style="width: 100%; height: 240px;"></textarea>
        <button class="button post-comentario">Afegeix</button>
      </div>
      <br style="margin-top: 2em;"/>
      
      <div class="row columns">
        <button th:if="${ not reunion.completada and reunion.admiteComentarios and permitirComentarios}" class="button add-comentario">Afegir un comentari</button>
      </div>  

      <div class="row columns">
        <div th:if="${permitirComentarios}" class="comentarios"></div>
      </div>

    </main>
    <script src="/goc/js/script.js"></script>
  </body>
</html>
